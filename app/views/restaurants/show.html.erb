


<body>
    
  <h1><%= @restaurant.name %></h1>
  <h2>Rank: <%= @restaurant.rank.chop %></h2>
  <h2>Stars: <%= @restaurant.stars %></h2>
  <h2>NY MAG Review:<%= link_to @restaurant.name, "http://nymag.com/listings/restaurant/#{@restaurant.nymag_page}" %> </h2>
  <% @review = Review.comments(current_user.id, @restaurant.id) %>
  <h2><%=link_to "Add Review", edit_review_path(@review.id) %>   </h2>
    


<div class="map" id="map-canvas" style="width:500px;height=500px"></div>
  <script type="text/javascript">

    var myCenter = new google.maps.LatLng(<%=@restaurant.yelp_location_coordinate_latitude%>,<%=@restaurant.yelp_location_coordinate_longitude%>);

      function initialize() {
        var mapOptions = {
          center: myCenter,
          zoom: 15,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        var map = new google.maps.Map(document.getElementById("map-canvas"),mapOptions);
      
        var marker = new google.maps.Marker({
			  	position:myCenter,
          <% unless current_user.reviews.where(:restaurant_id => @restaurant.id).first.date_dined == nil %>
            icon: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
            <% else %>
            icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
            <% end %>
			  });

			  marker.setMap(map);

        var contentString = '<div>Restaurant: <%= @restaurant.name %></div>' + '<br>' + '<div>Current Rank: <%= @restaurant.rank %></div>' + '<br>' +'<div>Phone: <%= @restaurant.yelp_display_phone %></div>'+ '<br>' +'<div>Yelp Review: <img src=<%= @restaurant.yelp_rating_img_url_small %>> </div>';

        var infowindow = new google.maps.InfoWindow({
          content: contentString
          });

			 

			google.maps.event.addListener(marker, 'click', function() {
			  infowindow.open(map,marker);
			  });
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>

</body>





